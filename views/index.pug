extends layout

block content
  .card
    .card-header
      h1 Bewerbungen
      .buttons
        a.btn(href="/new") + Neue Bewerbung
    // Toolbar: search (GET /?q=...)
    form(action="/", method="GET", role="search", aria-label="Suche", class="stack-12")
      .row.row-3
        .field
          label(for="q") Suche
          input#q(type="text", name="q", value=(typeof q !== 'undefined' ? q : ''), placeholder="Titel, Firma, Ort …")
        .field
          label(for="status") Status (optional)
          select#status(name="status")
            option(value="" selected=(!status)) — Alle —
            option(value="applied" selected=(status==='applied')) Angeschrieben
            option(value="not-applied" selected=(status==='not-applied')) Nicht angeschrieben
            option(value="answered" selected=(status==='answered')) Antwort erhalten
            option(value="no-answer" selected=(status==='no-answer')) Keine Antwort
        .field
          label(for="sort") Sortieren
          select#sort(name="sort")
            option(value="" selected=(!sort)) Neueste zuerst
            option(value="title" selected=(sort==='title')) Titel A–Z
            option(value="company" selected=(sort==='company')) Firma A–Z
      .form-actions.buttons
        button.btn(type="submit") Anwenden
        a.btn.secondary(href="/") Zurücksetzen

  if msg
    .card
      p.muted= msg

  if jobs && jobs.length
    table.table(aria-describedby="jobs-help")
      caption Bewerbungen – Übersicht
      thead
        tr
          th.scope(scope="col") #
          th(scope="col") Job
          th(scope="col") Unternehmen
          th(scope="col") Angeschrieben
          th(scope="col") Antwort
          th(scope="col") Aktionen
      tbody
        each job, i in jobs
          tr
            td= i+1
            td= job.title
            td= job.company.name || '—'
            td
              span(role="status" aria-label=(job.applied ? 'angeschrieben' : 'nicht angeschrieben'))
                = job.applied ? 'Ja' : 'Nein'
            td
              span(role="status" aria-label=(job.answer ? 'Antwort erhalten' : 'Keine Antwort'))
                = job.answer ? 'Ja' : 'Nein'
            td
              .buttons
                a.btn.secondary(href=`/jobs/${job._id}`) Details
                a.btn.warn(href=`/jobs/${job._id}/edit`) Bearbeiten
                form(method="POST", action=`/jobs/${job._id}?_method=DELETE`, style="display:inline")
                  input(type="hidden", name="_csrf", value=csrfToken)
                  button.btn.danger(type="submit") Löschen
                button.btn.secondary.js-copy-job(type="button", data-jobid=job._id aria-label=`Job kopieren: ${job.title}`) Kopieren
    p#jobs-help.muted Nutze Tabulator zur Navigation; Aktionen befinden sich in der letzten Spalte jeder Zeile.

  else
    .card.center.max-w-sm
      h2 Noch keine Jobs
      p.muted Lege deine erste Bewerbung an, um den Überblick zu behalten.
      .buttons.center
        a.btn(href="/new") Neue Bewerbung anlegen
