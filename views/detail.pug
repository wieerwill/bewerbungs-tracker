extends layout

block content
  // Kopfkarte mit Titel und Status
  .card
    .card-header
      h1= job && job.title ? job.title : 'Bewerbung'
      .buttons
        if job && job._id
          button.btn.secondary.js-copy-job(type="button", data-jobid=job && job._id) Kopieren
          a.btn.secondary(href="/") Übersicht
          a.btn.warn(href=`/edit/${job._id}`) Bearbeiten
          a.btn.danger(href=`/delete/${job._id}`) Löschen
    if job && (job.applied !== undefined || job.answer !== undefined)
      .stack-12
        .buttons
          // Applied Toggle
          if job.applied
            a.btn.secondary.active(href=`/toggle/${job._id}/applied`) Angeschrieben ✓
          else
            a.btn.secondary(href=`/toggle/${job._id}/applied`) Noch nicht angeschrieben
          // Answer Toggle
          if job.answer
            a.btn.secondary.active(href=`/toggle/${job._id}/answer`) Antwort erhalten ✓
          else
            a.btn.secondary(href=`/toggle/${job._id}/answer`) Keine Antwort

  if msg
    .card
      p.muted= msg

  // Beschreibung / Notizen
  if job && (job.description || job.note)
    .card
      if job.description
        h2 Beschreibung
        .prose!= renderMarkdown(job.description)
      if job.note
        h2 Notizen
        .prose!= renderMarkdown(job.note)

    .card
      h2 Rahmen & Vergütung
      .meta-grid
        if job.salary_min || job.salary_max
          .meta-item
            span.meta-label Gehaltsspanne
            span.meta-value
              | #{job.salary_min ? job.salary_min.toLocaleString() : '—'} – #{job.salary_max ? job.salary_max.toLocaleString() : '—'} #{job.salary_currency || 'EUR'} / #{job.salary_period==='month' ? 'Monat' : 'Jahr'}
        if job.salary_target
          .meta-item
            span.meta-label Zielgehalt
            span.meta-value #{job.salary_target.toLocaleString()} #{job.salary_currency || 'EUR'} / #{job.salary_period==='month' ? 'Monat' : 'Jahr'}
        if job.work_mode
          .meta-item
            span.meta-label Arbeitsmodus
            span.meta-value #{job.work_mode}#{job.remote_ratio ? ` (${job.remote_ratio}% Remote)` : ''}
        if job.seniority
          .meta-item
            span.meta-label Seniorität
            span.meta-value= job.seniority
        if job.employment_type
          .meta-item
            span.meta-label Anstellungsart
            span.meta-value= job.employment_type
        if job.contract_type
          .meta-item
            span.meta-label Vertrag
            span.meta-value= job.contract_type
        if job.start_date
          .meta-item
            span.meta-label Startdatum
            span.meta-value= job.start_date
        if job.deadline_date
          .meta-item
            span.meta-label Bewerbungsfrist
            span.meta-value= job.deadline_date
        if job.application_channel
          .meta-item
            span.meta-label Kanal
            span.meta-value= job.application_channel
        if job.source_url
          .meta-item
            span.meta-label Ausschreibung
            span.meta-value: a(href=job.source_url rel="noopener") Link
        .meta-item
          span.meta-label Referral
          span.meta-value
            if job.referral
              span.badge.badge-ok Ja
            else
              span.badge.badge-no Nein

  // Zwei Spalten: Unternehmen & Kontakt
  .row.row-2
    .card
      h2 Unternehmen
      - const company = job && job.company ? job.company : {};
      - const site = company && company.website ? (company.website.startsWith('http') ? company.website : `https://${company.website}`) : null;
      .meta-grid
        if company.name
          .meta-item
            span.meta-label Name
            span.meta-value= company.name
        if site
          .meta-item
            span.meta-label Website
            span.meta-value
              a(href=site rel="noopener")= company.website
        if company.street
          .meta-item
            span.meta-label Straße
            span.meta-value= company.street
        if company.city
          .meta-item
            span.meta-label Stadt
            span.meta-value= company.city
      if company.note
        .stack-12
          h3 Notizen
          p!= company.note

    .card
      h2 Kontakt
      - const contact = job && job.contact ? job.contact : {};
      - const phone = contact && (contact.phone || contact.telephone) ? (contact.phone || contact.telephone) : null;
      .meta-grid
        if contact.name
          .meta-item
            span.meta-label Name
            span.meta-value= contact.name
        if contact.email
          .meta-item
            span.meta-label E-Mail
            span.meta-value
              a(href=`mailto:${contact.email}`)= contact.email
        if phone
          .meta-item
            span.meta-label Telefon
            span.meta-value
              a(href=`tel:${phone}`)= phone
      if contact.note
        .stack-12
          h3 Notizen
          p!= contact.note

  // Footer-Karte mit Meta
  .card
    h2 Meta
    .meta-grid
      if job && job._id
        .meta-item
          span.meta-label Job ID
          span.meta-value= job._id
      if job && job.applied !== undefined
        .meta-item
          span.meta-label Applied
          span.meta-value
            if job.applied
              span.badge.badge-ok Ja
            else
              span.badge.badge-no Nein
      if job && job.answer !== undefined
        .meta-item
          span.meta-label Answer
          span.meta-value
            if job.answer
              span.badge.badge-ok Ja
            else
              span.badge.badge-no Nein
