extends layout

block content
  .card
    .card-header
      h1 Bewerbungen
      .buttons
        a.btn(href="/jobs/new") + Neue Bewerbung

  // Toolbar: GET /jobs?q=...
  .card
    form(action="/jobs", method="GET", role="search", aria-label="Suche", class="toolbar")
      span.muted Suche
      input#q(type="text", title="searchtext", aria-label="search text" name="q", value=(typeof q !== 'undefined' ? q : ''), placeholder="Titel, Firma, Ort ...", autocomplete="off")
      span.muted Status
      select#status(name="status", title="searchstatus", aria-label="search status")
        option(value="" selected=(!status)) -- Alle --
        option(value="discovered" selected=(status==='discovered')) Entdeckt
        option(value="applied" selected=(status==='applied')) Beworben
        option(value="answered" selected=(status==='answered')) Antwort erhalten
        option(value="invited" selected=(status==='invited')) Eingeladen
        option(value="rejected" selected=(status==='rejected')) Abgelehnt
        option(value="offer" selected=(status==='offer')) Angebot erhalten
      button.btn(type="submit") Anwenden
      a.btn.secondary(href="/jobs") Zurücksetzen

  if msg
    .card(role="status" aria-live="polite")
      p.muted= msg

  if jobs && jobs.length
    .table-wrap
      table.table(aria-describedby="jobs-help")
        thead
          tr
            th(scope="col") #
            th(scope="col") Job
            th(scope="col") Unternehmen
            th(scope="col") Status
            th(scope="col") Aktionen
        tbody
          each job, i in jobs
            tr
              td= i + 1
              td
                a.table-link(href=`/jobs/${job._id}`)= job.title
              td= job.company && job.company.name ? job.company.name : '—'
              td
                span.badge(class=job.status, role="status" aria-label=(job.status))
                  = job.status ? job.status : '-'
              td
                .buttons.nowrap
                  //a.btn.secondary(href=`/jobs/${job._id}`) Details
                  a.btn.warn(href=`/jobs/${job._id}/edit`) Bearbeiten
                  //form(method="POST", action=`/jobs/${job._id}?_method=DELETE`, style="display:inline")
                    input(type="hidden", name="_csrf", value=csrfToken)
                    button.btn.danger(type="submit") Löschen
                  // Clipboard: mit Fallback-Link wenn Clipboard-API nicht verfügbar ist
                  button.btn.success.js-copy-job(type="button", data-jobid=job._id aria-label=`Job kopieren: ${job.title}`) Kopieren
                  noscript
                    a.btn.success(href=`/api/jobs/${job._id}?format=markdown`) Kopieren

  else
    .card.center.max-w-sm
      h2 Noch keine Jobs
      p.muted Lege deine erste Bewerbung an, um den Überblick zu behalten.
      .buttons.center
        a.btn(href="/jobs/new") Neue Bewerbung anlegen
